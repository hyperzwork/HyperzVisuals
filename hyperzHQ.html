
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hyperz HQ Portal</title>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f10; color: white;
      display: flex; height: 100vh; overflow: hidden;
    }

    .sidebar {
      width: 240px; background: #1a1a1f;
      padding: 20px; display: flex; flex-direction: column;
      border-right: 2px solid #2e2e35;
    }

    .sidebar h2 { color: #9b59b6; margin-bottom: 30px; }
    .sidebar a {
      color: #ccc; text-decoration: none;
      padding: 10px; border-radius: 8px; margin-bottom: 10px;
      transition: background 0.2s ease, box-shadow 0.2s ease; cursor: pointer;
    }

    .sidebar a:hover, .sidebar a.active {
      background: #292933; color: #fff;
      box-shadow: 0 0 10px #9b59b6aa;
    }

    .main {
      flex: 1; padding: 20px; display: flex;
      flex-direction: column;
    }

    .header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px;
    }

    .status { font-size: 14px; color: #8eff8e; }

    .section {
      display: none;
      flex: 1;
      overflow: auto;
    }

    .section.active { display: block; }

    .messages {
      max-height: 60vh;
      overflow-y: auto; margin-bottom: 10px;
    }

    .messages p {
      margin: 8px 0; padding: 8px 12px;
      background: #2e2e35;
      border-radius: 8px; width: fit-content;
      max-width: 80%;
    }

    .input-area {
      display: flex; gap: 10px;
    }

    .input-area input {
      flex: 1; padding: 10px; border-radius: 8px;
      border: none; outline: none;
      background: #2e2e35; color: white;
    }

    .input-area button {
      background: #9b59b6;
      border: none; padding: 10px 15px;
      color: white; border-radius: 8px;
      cursor: pointer;
    }

    .card {
      background: #1f1f24;
      padding: 20px; border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #00000055;
    }

    .task-item {
      margin-bottom: 10px;
      padding: 8px;
      background: #2a2a33;
      border-radius: 6px;
    }

    #debug {
      background: #111; padding: 10px; font-size: 12px;
      color: #0f0; max-height: 100px; overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Hyperz HQ</h2>
    <a class="tab active" data-tab="dashboard">Dashboard</a>
    <a class="tab" data-tab="meeting">Meeting Room</a>
    <a class="tab" data-tab="chat">Team Chat</a>
    <a class="tab" data-tab="tasks">Tasks</a>
    <a class="tab" data-tab="settings">Settings</a>
  </div>

  <div class="main">
    <div class="header">
      <h1>Welcome, Team</h1>
      <div class="status" id="status">● Connecting...</div>
    </div>

    <div class="section active" id="dashboard">
      <div class="card">
        <h3>Activity Summary</h3>
        <p>Chats, meetings and tasks overview will appear here.</p>
        <ul id="onlineUsers"></ul>
      </div>
      <!-- DASHBOARD ADD-ONS -->
<div id="dashboard-widgets" style="padding: 1rem; color: white; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">

  <!-- Live Clock -->
  <div style="background: #2e2e2e; border-radius: 12px; padding: 1rem; box-shadow: 0 0 10px #6c4cff;">
    <h3 style="margin: 0; font-size: 1.2rem;">Current Time</h3>
    <p id="liveClock" style="font-size: 1.5rem; margin-top: 0.5rem;"></p>
  </div>

  <!-- Task Summary -->
  <div style="background: #2e2e2e; border-radius: 12px; padding: 1rem; box-shadow: 0 0 10px #6c4cff;">
    <h3 style="margin: 0; font-size: 1.2rem;">Task Summary</h3>
    <p>Total: <span id="taskTotal">0</span></p>
    <p>Completed: <span id="taskDone">0</span></p>
    <p>Pending: <span id="taskPending">0</span></p>
  </div>

  <!-- Quick Links -->
  <div style="background: #2e2e2e; border-radius: 12px; padding: 1rem; box-shadow: 0 0 10px #6c4cff;">
    <h3 style="margin: 0; font-size: 1.2rem;">Quick Actions</h3>
    <button onclick="scrollToSection('chat')" style="margin: 5px;">Open Chat</button>
    <button onclick="scrollToSection('tasks')" style="margin: 5px;">Add Task</button>
    <button onclick="scrollToSection('meeting')" style="margin: 5px;">Go to Meeting</button>
  </div>

</div>
    </div>

    <div class="section" id="meeting">
      <div class="card">
        <h3>Upcoming Meetings</h3>
        <ul>
          <li>Team sync – Monday 10AM</li>
          <li>Client review – Wednesday 4PM</li>
        </ul>
      </div>
      <div id="meeting-area" style="display:none; background:#1e1e1e; border-radius:12px; padding:20px; margin-top:20px;">
  <h3 style="color:white;">Hyperz Meeting Room</h3>
  <div style="margin:10px 0;">
    <input id="meeting-link" value="" readonly style="width:80%; padding:8px; border-radius:8px;" />
    <button onclick="copyMeetingLink()" style="padding:8px 12px; margin-left:10px;">Copy Link</button>
  </div>
  <div id="video-grid" style="display: grid; gap: 15px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); background:#121212; border-radius:12px; padding:10px;"></div>
  <div style="margin-top:15px; text-align:center;">
    <button id="startMeetingBtn">Start Meeting</button>
    <button id="toggleMicBtn" disabled>Mute Mic</button>
    <button id="toggleCamBtn" disabled>Mute Cam</button>
    <button id="leaveMeetingBtn" disabled>Leave</button>
  </div>
</div>
<audio id="joinSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
    </div>

    <div class="section" id="chat">
      <div class="card">
        <div class="messages" id="messages"></div>
        <div class="input-area">
          <input type="text" id="chatInput" placeholder="Type a message..." />
          <button onclick="sendMessage()">Send</button>
          <button onclick="startVoice()">Voice</button>
        </div>
      </div>
    </div>

    <div class="section" id="tasks">
      <div class="card">
        <h3>Team Tasks</h3>
        <div id="taskList"></div>
        <div class="input-area" style="margin-top:10px;">
          <input id="taskInput" placeholder="New Task..." />
          <button onclick="addTask()">Add</button>
        </div>
      </div>
    </div>

    <div class="section" id="settings">
      <div class="card">
        <h3>Settings</h3>
        <p>Dark Mode: <input type="checkbox" disabled checked></p>
        <p><button onclick="alert('Logged out')">Logout</button></p>
      </div>
    </div>

    <div id="debug"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getDatabase, ref, push, onChildAdded, set, onDisconnect, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBVPwQE9ovzcYJMsGQnndyjYiZcNjpv4-k",
      authDomain: "hyperzhq-f1910.firebaseapp.com",
      databaseURL: "https://hyperzhq-f1910-default-rtdb.firebaseio.com",
      projectId: "hyperzhq-f1910",
      storageBucket: "hyperzhq-f1910.appspot.com",
      messagingSenderId: "454289109507",
      appId: "1:454289109507:web:4e6f0b4723145ac7591436"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const statusEl = document.getElementById("status");
    const messagesBox = document.getElementById("messages");

    function debug(msg) {
      const log = document.getElementById("debug");
      log.innerHTML += "<div>" + msg + "</div>";
      log.scrollTop = log.scrollHeight;
    }

    function typeMessage(text) {
      let msg = document.createElement("p");
      msg.innerHTML = "<strong>Oracle:</strong> ";
      messagesBox.appendChild(msg);
      let i = 0;
      const interval = setInterval(() => {
        if (i < text.length) {
          msg.innerHTML += text[i++];
          messagesBox.scrollTop = messagesBox.scrollHeight;
        } else {
          clearInterval(interval);
        }
      }, 30);
    }

    signInAnonymously(auth).catch(e => debug("Sign-in failed: " + e.message));

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const uid = user.uid;
        debug("UID: " + uid);
        const statusRef = ref(db, `status/${uid}`);
        set(statusRef, "online");
        onDisconnect(statusRef).set("offline");

        statusEl.textContent = "● Online";
        statusEl.style.color = "#8eff8e";

        // Load messages
        const messagesRef = ref(db, "messages");
        onChildAdded(messagesRef, (snapshot) => {
          const { user, text } = snapshot.val();
          const msg = document.createElement("p");
          msg.innerHTML = `<strong>${user}:</strong> ${text}`;
          messagesBox.appendChild(msg);
          messagesBox.scrollTop = messagesBox.scrollHeight;
          debug("New message received: " + text);
        });

        // Show online users
        onValue(ref(db, "status"), (snapshot) => {
          const users = snapshot.val() || {};
          const onlineList = document.getElementById("onlineUsers");
          onlineList.innerHTML = "";
          for (const id in users) {
            const li = document.createElement("li");
            li.textContent = `User ${id.slice(0, 6)}: ${users[id]}`;
            li.style.color = users[id] === "online" ? "#8eff8e" : "#f55";
            onlineList.appendChild(li);
          }
        });

        // Load tasks
        const tasksRef = ref(db, "tasks");
        onChildAdded(tasksRef, (snap) => {
          const div = document.createElement("div");
          div.className = "task-item";
          div.textContent = snap.val().task;
          document.getElementById("taskList").appendChild(div);
        });

        // Greet Oracle
        typeMessage("Welcome to the HQ Portal.");
      }
    });

    window.sendMessage = function () {
      const input = document.getElementById("chatInput");
      const text = input.value.trim();
      if (!text) {
        debug("No message entered.");
        return;
      }

      const messagesRef = ref(db, "messages");
      push(messagesRef, { user: "Team", text })
        .then(() => debug("Message pushed."))
        .catch((err) => debug("Push failed: " + err.message));

      input.value = "";
    };

    window.startVoice = function () {
      alert("Voice chat coming soon, boss!");
    };

    window.addTask = function () {
      const taskInput = document.getElementById("taskInput");
      const task = taskInput.value.trim();
      if (!task) return;
      const tasksRef = ref(db, "tasks");
      push(tasksRef, { task });
      taskInput.value = "";
    };

    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        const id = tab.dataset.tab;
        document.querySelectorAll(".section").forEach(sec => {
          sec.classList.remove("active");
        });
        document.getElementById(id).classList.add("active");
      });
    });
    // Live Clock
function updateClock() {
  const now = new Date();
  const time = now.toLocaleTimeString();
  const date = now.toLocaleDateString();
  document.getElementById('liveClock').innerText = `${time} | ${date}`;
}
setInterval(updateClock, 1000);
updateClock();

// Scroll to section
function scrollToSection(id) {
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({ behavior: 'smooth' });
}

// Task Summary from Firebase
const taskRef = firebase.database().ref('tasks');
taskRef.on('value', (snapshot) => {
  let total = 0;
  let done = 0;
  snapshot.forEach((child) => {
    total++;
    if (child.val().done) done++;
  });
  document.getElementById('taskTotal').innerText = total;
  document.getElementById('taskDone').innerText = done;
  document.getElementById('taskPending').innerText = total - done;
});
    const meetingArea = document.getElementById('meeting-area');
const videoGrid = document.getElementById('video-grid');
const startMeetingBtn = document.getElementById('startMeetingBtn');
const toggleMicBtn = document.getElementById('toggleMicBtn');
const toggleCamBtn = document.getElementById('toggleCamBtn');
const leaveMeetingBtn = document.getElementById('leaveMeetingBtn');
const meetingLinkInput = document.getElementById('meeting-link');
const joinSound = document.getElementById('joinSound');

let localStream = null;
let peerConnections = {};
let micEnabled = true;
let camEnabled = true;
let userId = firebase.auth().currentUser?.uid || 'user_' + Math.floor(Math.random() * 999999);
let displayName = firebase.auth().currentUser?.email?.split('@')[0] || 'Guest';

const roomRef = firebase.database().ref('meetingRooms/hyperz_meeting_room/participants');
const signalRef = firebase.database().ref(`meetingSignals`);

function addVideoStream(id, stream, name, isLocal = false) {
  if (document.getElementById('vid_' + id)) return;
  const wrapper = document.createElement('div');
  wrapper.id = 'vid_' + id;
  wrapper.style.position = 'relative';

  const video = document.createElement('video');
  video.srcObject = stream;
  video.autoplay = true;
  video.playsInline = true;
  video.style.width = '100%';
  video.style.borderRadius = '12px';
  if (isLocal) video.muted = true;

  const label = document.createElement('div');
  label.textContent = name;
  label.style.position = 'absolute';
  label.style.bottom = '6px';
  label.style.left = '8px';
  label.style.background = '#000000aa';
  label.style.padding = '2px 6px';
  label.style.borderRadius = '6px';
  label.style.fontSize = '14px';
  label.style.color = '#fff';

  wrapper.appendChild(video);
  wrapper.appendChild(label);
  videoGrid.appendChild(wrapper);
}

function removeVideoStream(id) {
  const el = document.getElementById('vid_' + id);
  if (el) el.remove();
}

function copyMeetingLink() {
  navigator.clipboard.writeText(window.location.href + "#meeting");
  alert("Meeting link copied!");
}

startMeetingBtn.onclick = async () => {
  meetingArea.style.display = 'block';
  meetingLinkInput.value = window.location.href + "#meeting";

  startMeetingBtn.disabled = true;
  toggleMicBtn.disabled = false;
  toggleCamBtn.disabled = false;
  leaveMeetingBtn.disabled = false;

  localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  addVideoStream(userId, localStream, displayName, true);

  const myRef = roomRef.child(userId);
  myRef.set({ name: displayName });
  myRef.onDisconnect().remove();

  roomRef.on('child_added', snap => {
    const peerId = snap.key;
    const peerName = snap.val().name;
    if (peerId === userId || peerConnections[peerId]) return;

    joinSound.play();

    const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
    peerConnections[peerId] = pc;

    localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

    pc.onicecandidate = e => {
      if (e.candidate) {
        signalRef.child(`${userId}/${peerId}`).push({ type: 'ice', candidate: e.candidate });
      }
    };

    pc.ontrack = e => addVideoStream(peerId, e.streams[0], peerName);

    pc.createOffer().then(offer => {
      pc.setLocalDescription(offer);
      signalRef.child(`${peerId}/${userId}`).push({ type: 'offer', sdp: offer });
    });
  });

  roomRef.on('child_removed', snap => {
    const peerId = snap.key;
    if (peerConnections[peerId]) {
      peerConnections[peerId].close();
      delete peerConnections[peerId];
      removeVideoStream(peerId);
    }
  });

  signalRef.child(userId).on('child_added', snap => {
    const fromId = snap.ref.parent.key;
    const data = snap.val();
    if (!peerConnections[fromId]) {
      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
      peerConnections[fromId] = pc;

      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      pc.onicecandidate = e => {
        if (e.candidate) {
          signalRef.child(`${userId}/${fromId}`).push({ type: 'ice', candidate: e.candidate });
        }
      };

      pc.ontrack = e => roomRef.child(fromId).once('value').then(snap => {
        addVideoStream(fromId, e.streams[0], snap.val().name);
        joinSound.play();
      });
    }

    const pc = peerConnections[fromId];
    if (data.type === 'offer') {
      pc.setRemoteDescription(new RTCSessionDescription(data.sdp)).then(() => {
        return pc.createAnswer();
      }).then(answer => {
        pc.setLocalDescription(answer);
        signalRef.child(`${fromId}/${userId}`).push({ type: 'answer', sdp: answer });
      });
    } else if (data.type === 'answer') {
      pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
    } else if (data.type === 'ice' && data.candidate) {
      pc.addIceCandidate(new RTCIceCandidate(data.candidate));
    }
  });
};

toggleMicBtn.onclick = () => {
  micEnabled = !micEnabled;
  localStream.getAudioTracks()[0].enabled = micEnabled;
  toggleMicBtn.textContent = micEnabled ? 'Mute Mic' : 'Unmute Mic';
};

toggleCamBtn.onclick = () => {
  camEnabled = !camEnabled;
  localStream.getVideoTracks()[0].enabled = camEnabled;
  toggleCamBtn.textContent = camEnabled ? 'Mute Cam' : 'Unmute Cam';
};

leaveMeetingBtn.onclick = () => {
  roomRef.child(userId).remove();
  for (let id in peerConnections) {
    peerConnections[id].close();
    removeVideoStream(id);
  }
  peerConnections = {};
  removeVideoStream(userId);
  if (localStream) localStream.getTracks().forEach(t => t.stop());

  meetingArea.style.display = 'none';
  startMeetingBtn.disabled = false;
  toggleMicBtn.disabled = true;
  toggleCamBtn.disabled = true;
  leaveMeetingBtn.disabled = true;
};
  </script>
</body>
  </html>
            
